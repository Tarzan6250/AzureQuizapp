<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <appSettings>
    <!--
    Note: Add your MongoDB connection string and other environment variables here.
    You can also set these in the Azure portal under Application Settings.
    -->
    <add key="MONGO_URI" value="mongodb://localhost:27017/quizdb" />
    <add key="FLASK_APP" value="app.py" />
    <add key="FLASK_ENV" value="production" />
    <add key="SECRET_KEY" value="your-secret-key-change-this-in-production" />
  </appSettings>

  <system.webServer>
    <handlers>
      <!-- Remove server header for security -->
      <remove name="X-Powered-By" />

      <!-- HTTP to HTTPS redirect -->
      <rewrite>
        <rules>
          <rule name="HTTP to HTTPS redirect" stopProcessing="true">
            <match url="(.*)" />
            <conditions>
              <add input="{HTTPS}" pattern="off" ignoreCase="true" />
            </conditions>
            <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent" />
          </rule>
        </rules>
        <outboundRules>
          <rule name="Add Strict-Transport-Security when HTTPS" preCondition="ResponseIsHttps1">
            <match serverVariable="RESPONSE_Strict_Transport_Security" pattern=".*" />
            <action type="Rewrite" value="max-age=31536000; includeSubDomains" />
          </rule>
          <preConditions>
            <preCondition name="ResponseIsHttps1">
              <add input="{HTTPS}" pattern="on" ignoreCase="true" />
            </preCondition>
          </preConditions>
        </outboundRules>
      </rewrite>

      <!-- FastCGI handler for Python -->
      <add name="Python FastCGI"
           path="*.py"
           verb="*"
           modules="FastCgiModule"
           scriptProcessor="C:\Python39\python.exe|C:\Python39\Lib\site-packages\wfastcgi.py"
           resourceType="Either"
           responseBufferLimit="0" />
    </handlers>

    <!-- Static file caching -->
    <staticContent>
      <mimeMap fileExtension=".css" mimeType="text/css" />
      <mimeMap fileExtension=".js" mimeType="application/javascript" />
      <mimeMap fileExtension=".json" mimeType="application/json" />
    </staticContent>

    <!-- Request limits -->
    <security>
      <requestFiltering>
        <requestLimits maxAllowedContentLength="10485760" />
      </requestFiltering>
    </security>

    <!-- Error pages -->
    <httpErrors errorMode="DetailedLocalOnly">
      <remove statusCode="404" subStatusCode="-1" />
      <remove statusCode="500" subStatusCode="-1" />
      <error statusCode="404" responseMode="ExecuteURL" path="/static/404.html" />
      <error statusCode="500" responseMode="ExecuteURL" path="/static/500.html" />
    </httpErrors>
  </system.webServer>
</configuration>
